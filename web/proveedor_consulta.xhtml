<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Usuario</title>
        <h:outputStylesheet library="css" name="login.css" rendererType="text/css"/>
    </h:head>
    <body>
        <ui:composition template="./principal.xhtml">
            <ui:define name="content">

                <f:event type="preRenderView" listener="#{usuarioBean.listar(false)}" />
                <f:event type="preRenderView" listener="#{tipoUsuarioBean.listar(false)}" />

                <h:form id="formTablaUsuario">

                    
                        <p:button value="Nuevo"
                                  outcome="usuario.jsf"
                                  styleClass = "boton-nuevo-usuario"/>


                    <p:dataTable rows="10" 
                                 paginator="true"
                                 paginatorPosition="bottom" 
                                 selection="#{usuarioBean.selectUser}"
                                 selectionMode="single"
                                 rowKey="#{usuario.codigo}"
                                 id="usuariotabla" 
                                 filteredValue="#{usuarioBean.usuariosFiltrados}"
                                 styleClass="datatable-tam"
                                 value="#{usuarioBean.lista}" 
                                 var="usuario">
                        <p:ajax event="rowSelect"
                                listener="#{usuarioBean.onSelect}"
                                update=":msg"/>
                       

                        <p:column  width="70">
                            <p:spacer width="10" height="10"/>
                            <p:commandLink action="#{usuarioBean.onEditClick}">
                                <h:graphicImage library="imagenes" 
                                                name="editar.png" 
                                                styleClass="dimension-imagen"/>
                                
                                <f:setPropertyActionListener 
                                    target="#{usuarioBean.dao}"
                                    value="#{usuario}"/>
                               
                                <f:setPropertyActionListener 
                                    target="#{usuarioBean.nombreVentana}" 
                                    value="Modificar"/>
                            </p:commandLink>

                            <p:spacer width="10" height="10"/>

                            <p:commandLink oncomplete="PF('wv-dialogo-eliminar').show();" update=":formTablaUsuario:id-dialogo-eliminar">
                                
                                <h:graphicImage library="imagenes" 
                                                name="anular.png" 
                                                styleClass="dimension-imagen"/>

                                <f:setPropertyActionListener 
                                    target="#{usuarioBean.dao}" 
                                    value="#{usuario}"/>
                                 
                            </p:commandLink>
                        </p:column>

                        <p:column headerText="Código" 
                                  filterBy="#{usuario.codigo}"
                                  filterMatchMode="contains"
                                  sortBy="#{usuario.codigo}">
                            <p:outputLabel value="#{usuario.codigo}"/>
                        </p:column>

                        <p:column headerText="Nombre" 
                                  filterBy="#{usuario.nombre}"
                                  filterMatchMode="contains"
                                  sortBy="#{usuario.nombre}">
                            <p:outputLabel value="#{usuario.nombre}"/>
                        </p:column>

                        <p:column headerText="Apellido" 
                                  filterBy="#{usuario.apellido}" 
                                  filterMatchMode="contains"
                                  sortBy="#{usuario.apellido}">
                            <p:outputLabel value="#{usuario.apellido}"/>
                        </p:column>

                        <p:column headerText="Tipo Usuario">
                            <p:outputLabel value="#{usuario.destipousuario}"/>
                        </p:column>

                        <p:column headerText="Estado">
                            <p:outputLabel value="#{usuario.estado}"/>
                        </p:column>

                    </p:dataTable>
                    
                    <p:confirmDialog widgetVar="wv-dialogo-eliminar"
                                     message="¿Eliminar a #{usuarioBean.dao.nombre}?"
                                     header="Confirmar eliminacion"
                                     styleClass="ui-confirmar-eliminar-dialogo"
                                     id="id-dialogo-eliminar">
                        
                        <p:commandButton value="Si" 
                                         action="#{usuarioBean.inactivar()}"
                                         update="usuariotabla"
                                         oncomplete="PF('wv-dialogo-eliminar').hide();" />
                        
                        <p:commandButton value="No"
                                         immediate="true"
                                         oncomplete="PF('wv-dialogo-eliminar').hide();" />

                    </p:confirmDialog>

                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
